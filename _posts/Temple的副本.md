---
layout: post
title: title
category: 在路上
tags: tags
keywords: keywords
description: desc1
---

### 背景

如今，随着拍摄设备的普及，我们随时随地都可以留下各种影像，随着时间的积累，会有越来越多的照片。极大方便的同时也带来了很多问题，例如：

- 想找某一张很久前的照片没法找到

- 看到一张照片以后想不到什么时候拍摄的

从19年初开始，就陆续启动了历史照片的整理工作，由于工作的原因，断断续续整理，目前基本上把从2008年到2019年初的大部分照片都已经整理完成了（视频尚未开始，因此这篇文章仅仅记录照片整理）。这里的照片包括：

- 历史微云、各种SD卡，各种硬盘和U盘的历史数据

- 人人网、QQ空间、微博等使用过社交平台的照片

### 方案

- 所有照片按照时间归档，照片文件名格式为：`YYYY-MM-DD_hh-mm-ss.JPG`，例如`2013-03-09_11-51-23.JPG`，如果重名，就添加`-(1)`等标示

- 所有照片按月分文件夹归档（后续会介绍为什么按照月份）

- 对于日期不明确的照片，采用交叉验证的方式推测一个大概日期，然后以尽可能精确的时间命名

- 目前正规划建立一个照片的数据库，对于照片的信息（备注、标签、特征等），都保存在数据库，仅仅在展示时使用真实数据

### 操作方法

#### 怎么获取并按照指定格式归档照片

- 自动归档

	之前为了方便写游记，已经专门开发了一款查看照片信息的工具，具体的使用方法可以参考文章 [基于命令行的照片整理及查看工具 \| 子勰的博客](https://blog.bihe0832.com/photomanage.html) 通过命令行对于可以被按照拍摄时间成功重新命名的照片，在整理到目标目录后，原目录的照片会被删除；对于无法被重命名的照片，不做整理，同时保留该文件夹内上一张可以被重命名的照片做对比参照。
	
- iOS Photos归档

	对于iPhono的截图、或者别人发送的不带位置信息的照片的截图，目前使用上面的工具或者一些其他工具都不能查看时间信息。但是如果导入到iMac的Photos，是可以识别的。因此可以先把所有照片导入Photos，然后按照日期导出，这样也阔以拿到照片信息
	
- 微博、人人网、QQ空间时间戳归档

	对于发布到社交平台的照片，绝大部分都会被压缩导致时间信息被抹去，对于这类照片，在下载时结合当时的动态内容，可以推断一个推测时间
	
- 基于文件名分析归档

	对于部分拍摄设备或者软件，虽然因为压缩会丢失照片的附加信息，但是文件名有些时使用时间戳命名的，可以通过时间戳转换得到时间	

- 通过上下文分析

	对于以上方法都无法分析出的照片，只能通过历史记忆，然后寻找同时候照片，推断时间

#### 对于部分照片，批量修改

- 照片名称批量修改

	对于上面提到的提供上下文分析或者Photos归档的照片，需要将他们按照指定格式重命名，可以使用下面的命令快速实现
		
		➜  33  ls
		IMG_3456.jpg IMG_3457.jpg IMG_3459.jpg IMG_3460.jpg IMG_3461.jpg IMG_3463.jpg IMG_3464.jpg IMG_3465.jpg rename.sh
		➜  33  cat rename.sh
		#/bin/bash
		cd $1
		pwd
		i=1; for x in *.JPG ; do mv $x "$2-$3-$4-00-00-00-($i).JPG"; let i=i+1; done
		i=1; for x in *.png ; do mv $x "$2-$3-$4-00-00-00-($i).PNG"; let i=i+1; done
		i=1; for x in *.jpg ; do mv $x "$2-$3-$4-00-00-00-($i).JPG"; let i=i+1; done
		i=1; for x in *.PNG ; do mv $x "$2-$3-$4-00-00-00-($i).PNG"; let i=i+1; done
		echo "Finished"
		➜  33  /bin/bash ./rename.sh ~/zixie/temp/1/33 2018 11 23
		/Users/zixie/zixie/temp/1/33
		mv: rename *.JPG to 2018-11-23-00-00-00-(1).JPG: No such file or directory
		mv: rename *.png to 2018-11-23-00-00-00-(1).PNG: No such file or directory
		mv: rename *.PNG to 2018-11-23-00-00-00-(1).PNG: No such file or directory
		Finished
		➜  33  ls
		2018-11-23-00-00-00-(1).JPG 2018-11-23-00-00-00-(4).JPG 2018-11-23-00-00-00-(7).JPG
		2018-11-23-00-00-00-(2).JPG 2018-11-23-00-00-00-(5).JPG 2018-11-23-00-00-00-(8).JPG
		2018-11-23-00-00-00-(3).JPG 2018-11-23-00-00-00-(6).JPG rename.sh
		➜  33		

### 遇到的问题

1. 部分拍摄设备记录的时间不是格林尼治时间，而是当地时间，对于这类照片，需要批量结合时区调整时间。而且这类照片很难发现，尤其是时区相差不大的时候

2. 有时候会使用连拍等方式，导致会有很多很相似的照片，这部分照片其实可以选择后只保留个别几张

3. 如果不是先拍照片，而是使用微信里面的拍摄拍照，然后发送，即使选择原图，微信也会清除位置信息，因此建议任何时候先用手机相机拍照，然后再让各种软件使用。对于这类照片，可以用iOS的 Photos 结合上下文分析确认，这部分工作最耗时，我当时处理几千张这样的照片，基本用了一个月直接吐血