---
layout: post
title: 基于微信公共账号实现会议二维码签到
category: 微信公共平台
tags: 公共平台
keywords: 二维码 签到 微信公共平台
description: 基于二维码实现签到的完整流程
---
## 原理：

     签到页面先去检测本地的cookie，如果本地cookie和通过授权页面设置的不一致，视为未授权设备，直接跳转到指定的页面；如果一致，拉取用户的报名信息。
    

## 关键点：

     1.微信内置的webview支持cookie和页面之间的JS跳转
     2.微信扫一扫支持直接跳转到扫描结果
    

## 风险点：

     1.生成二维码的接口都是调用第三方，不是自己控制，可能会挂掉
     2.生成的二维码一般第三方都会有图片保存，不够安全
    

## 缺点：

     1.使用微信扫一扫要先登陆微信，如果设备较多，需要足够的微信账号
    

## 后续优化：

     1.目前接口直接用了openID，没有做进一步验证，可以增加一个签名，例如openID和appid字典序MD5增加在入场券的二维码中，获取签到信息的时候后台验证一下
     2.出现签到失败可以给后台发送一条告警，及时发现和定位异常
     3.自己写一个js二维码
    

## demo 使用：

    1.设备1（与会者手机）根据需求扫描对应二维码获取入场券。PS：现实场景入场券为事先获得
    

![二维码入场券](https://blog.bihe0832.com/public/images/qrsign1.png "二维码入场券")

    2.设备2（会场签到设备）打开微信，扫描设备1入场券，无法获得报名信息 
    3.设备2打开微信，扫描下方二维码获得授权 
    

![签到设备授权](https://blog.bihe0832.com/public/images/qrsign2.png "签到设备授权")

    4.设备2再次扫描设备1入场券，获得报名信息并签到 
    5.设备1扫描不同类别的与会者二维码后，重复第四步
    

## 代码结构：

     — conf:二维码签到demo中所有的核心配置，更改配置以后即可为你所用。
     — css:页面css
     — images:资源图片
     — js:页面js
     — intro.php:会议介绍页面，未授权设备扫码后跳转页面
     — my_bak.php: 使用公司内部生成二维码接口生成二维码入场券页面
     — my.php: 使用外部第三方生成二维码接口生成二维码入场券页面
     — sign.php: 授权后设备扫描入场券以后跳转页面
     — signPre.php: 设备授权
     — signAfter.php: 设备取消授权
    

## 源码下载：

*   <https://microdemo.bihe0832.com/QrcodeSign/demo.zip>
*   <https://github.com/bihe0832/QrcodeSign>
